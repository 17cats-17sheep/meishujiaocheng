# 联机游戏的基本概念

## 联机游戏与单机游戏

说起联机游戏，就不得不提一个与之相对立的概念“单机游戏”，在互联网发展早期大部分游戏都是单机游戏。随着互联网的发展以及手机、电脑的普及，越来越多游戏开发商开始制作联机游戏。

接下来我们站在游戏开发者角度，对比这两类游戏在开发中常见区别：

| 功能点   | 联机游戏                                                     | 单机游戏                                                     |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 存档数据 | 存储在服务器。                                               | 存储在玩家设备（电脑/手机）。                                |
| 游戏逻辑 | 部分关键逻辑在服务端，同步结果给客户端。                     | 全都在客户端。                                               |
| 玩家交互 | 需要将玩家操作先发送给服务端，经过服务器计算再发送给所有玩家客户端做表现，存在网络延迟需要特殊逻辑处理。 | 全部逻辑都在客户端执行，不存在网络延迟，需要开发者考虑的问题点更少。 |

## 什么是 C / S 架构

C 指的是 client（客户端），S 指的是 Server（服务端），所有的客户端软件在运行后通过网络连接到服务端，用户在客户端修改的数据等都会被发送到服务端，服务端在接收到数据后进行处理，然后将处理结果发送给指定客户端或所有客户端。

通常使用 C / S 架构的客户端软件在没有连接到服务端之前是无法正常使用的，另外在使用过程中如因为网络波动等问题与服务端断开了链接，之后也无法正常使用。

![image-20230519165955828](https://arkimg.ark.online/image-20230519165955828-1684486797364-1.webp)

<center>（图 1 C/S 架构示意）</center>

## 服务端主要职能

1. 存储玩家数据：服务端需要存储玩家数据，以保证数据的可靠性和持久性。
2. 处理玩家请求：服务端需要处理玩家的请求。验证玩家身份、检查玩家行为是否合法，并向玩家提供游戏状态和结果。
3. 管理游戏状态：服务端需要维护游戏状态，包括玩家位置、物品、任务等信息，确保游戏状态在不同客户端之间同步。

## 客户端主要职能

1. 处理玩家的输入：客户端需要接收玩家的输入操作，如玩家点击按钮、移动角色等。
2. 游戏画面展示：客户端需要负责展示游戏画面，包括游戏场景、角色、物品、动画等。
3. 游戏 UI ：客户端需要设计用户界面，包括游戏设置、角色信息、背包等界面，以提供给玩家更好的游戏体验。
4. 部分游戏计算逻辑：一些简单的计算逻辑可以放在客户端进行处理，例如计算玩家移动速度、跳跃高度等。这样可以减轻服务器的负担，提高游戏运行效率。

## 编程建议：

1. 所有关键数据在客户端和服务端都做验证。例如购买物品时判断金币是否足够，先在客户端验证一次数据是否为合法数据（比如购买数量不能为负数）验证没问题之后再发送给服务端，然后服务端验证金币数量等。这样可以在客户端发送时就拦截掉不合理的数据，减轻服务端压力。
2. 高频的操作先在本地缓存，之后再定时发送给服务端。例如 PVE 射击游戏中射速特别快的武器对怪物造成的伤害，可以在客户端统计造成的伤害量然后每秒打包发送一次，这样可以有效降低数据发送频率减轻服务端与客户端的 CPU 压力。
3. 游戏表现层与数据层要分开，最终呈现得效果完全依赖于逻辑数据，但是逻辑数据不应该依赖效果。比如回合制游戏中的加速功能与跳过战斗功能，就是比较典型的例子。玩家在点击战斗开始按钮后，服务端就会把整场战斗数据包括最终结算数据运算完毕发送回客户端。这时玩家可以选择一步一步看下去、加速看、或者直接跳过，都不会影响游戏的运行逻辑与最终结算时奖励的数量。